/* ===========================================================
 * pagepiling.js 1.3
 *
 * https://github.com/alvarotrigo/pagePiling.js
 * MIT licensed
 *
 * Copyright (C) 2014 alvarotrigo.com - A project by Alvaro Trigo
 *
 * ========================================================== */
!function(n,o,e,t){n.fn.pagepiling=function(i){function a(n){n.addClass("pp-table").wrapInner('<div class="pp-tableCell" style="height:100%" />')}function s(){function o(){F.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",o),n("body").addClass("pageover-done"),p(n(".pp-section").last(),!1,!0)}n("body").addClass("pageover"),F.on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",o);var e=(new Date).getTime();Q=e,q(!1,n(".pp-section").length)}function r(){n("body").removeClass("pageover-done pageover"),p(n(".pp-section").last()),Q=(new Date).getTime()}function c(o){var e=n(".pp-section.active").index(".pp-section"),t=o.index(".pp-section");return e>t?"up":"down"}function p(o,e,t){var i={destination:o,animated:e,activeSection:n(".pp-section.active"),anchorLink:o.data("anchor"),sectionIndex:o.index(".pp-section"),toMove:o,yMovement:c(o),leavingSection:n(".pp-section.active").index(".pp-section")+1};if(i.activeSection.is(o))return void(t||q(i.anchorLink,i.sectionIndex));n("body").hasClass("pageover")&&!t&&n("body").removeClass("pageover-done pageover"),"undefined"==typeof i.animated&&(i.animated=!0),"undefined"!=typeof i.anchorLink&&f(i.anchorLink,i.sectionIndex),i.destination.addClass("active").siblings().removeClass("active"),i.sectionsToMove=u(i),"down"===i.yMovement?(i.translate3d=U(),i.scrolling="-100%",options.css3||i.sectionsToMove.each(function(o){o!=i.activeSection.index(".pp-section")&&n(this).css(h(i.scrolling))}),i.animateSection=i.activeSection):(i.translate3d="translate3d(0px, 0px, 0px)",i.scrolling="0",i.animateSection=o),n.isFunction(options.onLeave)&&options.onLeave.call(this,i.leavingSection,i.sectionIndex+1,i.yMovement),l(i),t||z(i.anchorLink),t||q(i.anchorLink,i.sectionIndex),W=i.anchorLink;var a=(new Date).getTime();Q=a}function l(o){options.css3?(b(o.animateSection,o.translate3d,o.animated),o.sectionsToMove.each(function(){b(n(this),o.translate3d,o.animated)}),setTimeout(function(){d(o)},options.scrollingSpeed)):(o.scrollOptions=h(o.scrolling),o.animated?o.animateSection.animate(o.scrollOptions,options.scrollingSpeed,options.easing,function(){v(o),d(o)}):(o.animateSection.css(h(o.scrolling)),setTimeout(function(){v(o),d(o)},400)))}function d(o){n.isFunction(options.afterLoad)&&options.afterLoad.call(this,o.anchorLink,o.sectionIndex+1)}function u(o){var e;return e=n(".pp-section").map("down"===o.yMovement?function(e){return e<o.destination.index(".pp-section")?n(this):void 0}:function(e){return e>o.destination.index(".pp-section")?n(this):void 0})}function v(o){var e;return"up"===o.yMovement&&o.sectionsToMove.each(function(){n(this).css(h(o.scrolling))}),e}function h(n){return"vertical"===options.direction?{top:n}:{left:n}}function f(n,o){options.anchors.length?(location.hash=n,g(location.hash)):g(String(o))}function g(o){o=o.replace("#",""),n("body")[0].className=n("body")[0].className.replace(/\b\s?pp-viewing-[^\s]+\b/g,""),n("body").addClass("pp-viewing-"+o)}function m(){var o=e.location.hash.replace("#",""),t=o,i=n('.pp-section[data-anchor="'+t+'"]');i.length>0&&p(i,options.animateAnchor)}function S(){var n=(new Date).getTime();return n-Q<K+options.scrollingSpeed?!0:!1}function w(){var o=e.location.hash.replace("#","").split("/"),t=o[0];if(t.length){if(t&&t!==W){if(isNaN(t))var i=n('[data-anchor="'+t+'"]');else var i=n(".pp-section").eq(t-1);p(i)}}}function y(n){return{"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n,transform:n}}function b(n,o,e){n.toggleClass("pp-easing",e),n.css(y(o))}function E(t){if(!S()){t=e.event||t;var i=Math.max(-1,Math.min(1,t.wheelDelta||-t.deltaY||-t.detail));if(options.pageOver&&V&&V.is(this))i>0&&0==n(o).scrollTop()&&r();else{var a=n(".pp-section.active"),s=T(a);0>i?x("down",s):x("up",s)}return!1}}function x(n,o){if("down"==n)var e="bottom",t=B.moveSectionDown;else var e="top",t=B.moveSectionUp;if(o.length>0){if(!isScrolled(e,o))return!0;t()}else t()}function T(n){return scrollable=n.find(".pp-scrollable"),scrollable}function M(){F.get(0).addEventListener?(F.get(0).removeEventListener("mousewheel",E,!1),F.get(0).removeEventListener("wheel",E,!1),options.pageOver&&V&&(V.get(0).removeEventListener("mousewheel",E,!1),V.get(0).removeEventListener("wheel",E,!1))):options.pageOver&&V&&V.get(0).detachEvent("onmousewheel",E)}function C(){F.get(0).addEventListener?(F.get(0).addEventListener("mousewheel",E,!1),F.get(0).addEventListener("wheel",E,!1),options.pageOver&&V&&(V.get(0).addEventListener("mousewheel",E,!1),V.get(0).addEventListener("wheel",E,!1))):(F.get(0).attachEvent("onmousewheel",E),options.pageOver&&V&&V.get(0).attachEvent("onmousewheel",E))}function k(){R&&(MSPointer=O(),F.off("touchstart "+MSPointer.down).on("touchstart "+MSPointer.down,Y),F.off("touchmove "+MSPointer.move).on("touchmove "+MSPointer.move,D))}function L(){R&&(MSPointer=O(),F.off("touchstart "+MSPointer.down),F.off("touchmove "+MSPointer.move))}function O(){var n;return n=e.PointerEvent?{down:"pointerdown",move:"pointermove",up:"pointerup"}:{down:"MSPointerDown",move:"MSPointerMove",up:"MSPointerUp"}}function X(n){var o=new Array;return o.y="undefined"!=typeof n.pageY&&(n.pageY||n.pageX)?n.pageY:n.touches[0].pageY,o.x="undefined"!=typeof n.pageX&&(n.pageY||n.pageX)?n.pageX:n.touches[0].pageX,o}function P(n){return"undefined"==typeof n.pointerType||"mouse"!=n.pointerType}function Y(n){var o=n.originalEvent;if(P(o)){var e=X(o);j=e.y,touchStartX=e.x}}function D(o){var e=o.originalEvent;if(!I(o.target)&&P(e)){o.preventDefault();var t=n(".pp-section.active"),i=T(t);if(!S()){var a=X(e);touchEndY=a.y,touchEndX=a.x,"horizontal"===options.direction&&Math.abs(touchStartX-touchEndX)>Math.abs(j-touchEndY)?Math.abs(touchStartX-touchEndX)>F.width()/100*options.touchSensitivity&&(options.pageOver&&V&&V.is(this)?touchEndX>touchStartX&&r():touchStartX>touchEndX?x("down",i):touchEndX>touchStartX&&x("up",i)):Math.abs(j-touchEndY)>F.height()/100*options.touchSensitivity&&(options.pageOver&&V&&V.is(this)?touchEndY>j&&r():j>touchEndY?x("down",i):touchEndY>j&&x("up",i))}}}function I(o,e){e=e||0;var t=n(o).parent();return e<options.normalScrollElementTouchThreshold&&t.is(options.normalScrollElements)?!0:e==options.normalScrollElementTouchThreshold?!1:I(t,++e)}function N(){n("body").append('<div id="pp-nav"><ul></ul></div>');var o=n("#pp-nav");o.css("color",options.navigation.textColor),o.addClass(options.navigation.position);for(var e=0;e<n(".pp-section").length;e++){var t="";if(options.anchors.length&&(t=options.anchors[e]),"undefined"!==options.navigation.tooltips){var i=options.navigation.tooltips[e];"undefined"==typeof i&&(i="")}o.find("ul").append('<li data-tooltip="'+i+'"><a href="#'+t+'"><span></span></a></li>')}options.pageOver&&o.find("ul").append('<li data-tooltip=""><a href="#"><span></span></a></li>'),o.find("span").css("border-color",options.navigation.bulletsColor)}function q(o,e){options.navigation&&(n("#pp-nav").find(".active").removeClass("active"),o?n("#pp-nav").find('a[href="#'+o+'"]').addClass("active"):n("#pp-nav").find("li").eq(e).find("a").addClass("active"))}function z(o){options.menu&&(n(options.menu).find(".active").removeClass("active"),n(options.menu).find('[data-menuanchor="'+o+'"]').addClass("active"))}function A(){var n,i=o.createElement("p"),a={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};o.body.insertBefore(i,null);for(var s in a)i.style[s]!==t&&(i.style[s]="translate3d(1px,1px,1px)",n=e.getComputedStyle(i).getPropertyValue(a[s]));return o.body.removeChild(i),n!==t&&n.length>0&&"none"!==n}function U(){return"vertical"!==options.direction?"translate3d(-100%, 0px, 0px)":"translate3d(0px, -100%, 0px)"}var W,B=n.fn.pagepiling,F=n(this),Q=0,R="ontouchstart"in e||navigator.msMaxTouchPoints>0||navigator.maxTouchPoints,j=touchStartX=touchEndY=touchEndX=0,K=600;options=n.extend(!0,{direction:"vertical",menu:null,verticalCentered:!0,sectionsColor:[],anchors:[],scrollingSpeed:700,easing:"easeInQuart",loopBottom:!1,loopTop:!1,css3:!0,navigation:{textColor:"#000",bulletsColor:"#000",position:"right",tooltips:[]},normalScrollElements:null,normalScrollElementTouchThreshold:5,touchSensitivity:5,keyboardScrolling:!0,sectionSelector:".section",animateAnchor:!1,pageOver:!1,afterLoad:null,onLeave:null,afterRender:null},i);var V=options.pageOver||!1;n.extend(n.easing,{easeInQuart:function(n,o,e,t,i){return t*(o/=i)*o*o*o+e}}),B.setScrollingSpeed=function(n){options.scrollingSpeed=n},B.setMouseWheelScrolling=function(n){n?C():M()},B.setAllowScrolling=function(n){n?(B.setMouseWheelScrolling(!0),k()):(B.setMouseWheelScrolling(!1),L())},B.setKeyboardScrolling=function(n){options.keyboardScrolling=n},B.moveSectionUp=function(){var o=n(".pp-section.active").prev(".pp-section");!o.length&&options.loopTop&&(o=n(".pp-section").last()),o.length&&p(o)},B.moveSectionDown=function(){var o=n(".pp-section.active").next(".pp-section");!o.length&&options.loopBottom&&(o=n(".pp-section").first()),o.length?p(o):options.pageOver&&s()},B.moveTo=function(o){var e="";e=isNaN(o)?n('[data-anchor="'+o+'"]'):n(".pp-section").eq(o-1),e.length>0&&p(e)},n(options.sectionSelector).each(function(){n(this).addClass("pp-section")}),options.css3&&(options.css3=A()),options.pageOver&&(n("html, body").addClass("pp-po-body"),F.addClass("pp-po-container")),n(F).css({overflow:"hidden","-ms-touch-action":"none","touch-action":"none"}),B.setAllowScrolling(!0),n.isEmptyObject(options.navigation)||N();var G=n(".pp-section").length;n(".pp-section").each(function(o){n(this).data("data-index",o),n(this).css("z-index",G),o||0!==n(".pp-section.active").length||n(this).addClass("active"),"undefined"!=typeof options.anchors[o]&&n(this).attr("data-anchor",options.anchors[o]),"undefined"!=typeof options.sectionsColor[o]&&n(this).css("background-color",options.sectionsColor[o]),options.verticalCentered&&a(n(this)),G-=1}).promise().done(function(){options.navigation&&(n("#pp-nav").css("margin-top","-"+n("#pp-nav").height()/2+"px"),n("#pp-nav").find("li").eq(n(".pp-section.active").index(".pp-section")).find("a").addClass("active")),n(e).on("load",function(){m()}),n.isFunction(options.afterRender)&&options.afterRender.call(this)}),n(e).on("hashchange",w),n(o).keydown(function(o){if(options.keyboardScrolling&&!S())switch(o.which){case 38:case 33:B.moveSectionUp();break;case 40:case 34:B.moveSectionDown();break;case 36:B.moveTo(1);break;case 35:options.pageOver?s():B.moveTo(n(".pp-section").length);break;case 37:B.moveSectionUp();break;case 39:B.moveSectionDown();break;default:return}}),options.normalScrollElements&&(n(o).on("mouseenter",options.normalScrollElements,function(){B.setMouseWheelScrolling(!1)}),n(o).on("mouseleave",options.normalScrollElements,function(){B.setMouseWheelScrolling(!0)})),n(o).on("click touchstart","#pp-nav a",function(o){o.preventDefault();var e=n(this).parent().index();options.pageOver&&n(".pp-section").length<=e?s():p(n(".pp-section").eq(e))}),n(o).on({mouseenter:function(){var o=n(this).data("tooltip");n('<div class="pp-tooltip '+options.navigation.position+'">'+o+"</div>").hide().appendTo(n(this)).fadeIn(200)},mouseleave:function(){n(this).find(".pp-tooltip").fadeOut(200,function(){n(this).remove()})}},"#pp-nav li")}}(jQuery,document,window);